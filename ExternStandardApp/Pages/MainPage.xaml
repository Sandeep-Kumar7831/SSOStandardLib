<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ExternStandardApp.Pages.MainPage"
             Title="Token Reader">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <Label Text="Token Reader App" 
                   FontSize="28" 
                   FontAttributes="Bold"
                   HorizontalTextAlignment="Center" />

            <Label Text="Reads tokens from SsoMauiApp" 
                   FontSize="12"
                   TextColor="Gray"
                   HorizontalTextAlignment="Center" />

            <!-- Status Message -->
            <Frame BorderColor="LightGray" 
                   CornerRadius="10" 
                   Padding="15"
                   HasShadow="True">
                <VerticalStackLayout Spacing="5">
                    <Label Text="Status:" FontAttributes="Bold" />
                    <Label Text="{Binding StatusMessage}" 
                           FontSize="12"
                           LineBreakMode="WordWrap" />
                </VerticalStackLayout>
            </Frame>

            <!-- Debug Info -->
            <Frame BorderColor="Orange" 
                   CornerRadius="10" 
                   Padding="15"
                   HasShadow="True"
                   IsVisible="{Binding DebugInfo, StringFormat='{0}', Converter={StaticResource StringToBoolConverter}}">
                <VerticalStackLayout Spacing="5">
                    <Label Text="Debug Info:" FontAttributes="Bold" FontSize="11" />
                    <Label Text="{Binding DebugInfo}" 
                           FontSize="10"
                           TextColor="DarkOrange"
                           LineBreakMode="WordWrap"
                           FontFamily="monospace" />
                </VerticalStackLayout>
            </Frame>

            <!-- Loading Indicator -->
            <ActivityIndicator IsRunning="{Binding IsLoading}" 
                              IsVisible="{Binding IsLoading}"
                              Color="Blue" />

            <!-- Tokens Display -->
            <Frame BorderColor="Green" 
                   CornerRadius="10" 
                   Padding="15"
                   HasShadow="True"
                   IsVisible="{Binding TokenFound}">
                <VerticalStackLayout Spacing="10">
                    <Label Text="🔓 Tokens Successfully Read!" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           TextColor="Green" />

                    <StackLayout Spacing="8">
                        <Label Text="Access Token:" 
                               FontAttributes="Bold"
                               FontSize="12" />
                        <Label Text="{Binding AccessToken}" 
                               FontSize="11"
                               TextColor="DarkGray"
                               LineBreakMode="WordWrap"
                               FontFamily="monospace" />
                    </StackLayout>

                    <StackLayout Spacing="8">
                        <Label Text="Refresh Token:" 
                               FontAttributes="Bold"
                               FontSize="12" />
                        <Label Text="{Binding RefreshToken}" 
                               FontSize="11"
                               TextColor="DarkGray"
                               LineBreakMode="WordWrap"
                               FontFamily="monospace" />
                    </StackLayout>

                    <StackLayout Spacing="8">
                        <Label Text="ID Token:" 
                               FontAttributes="Bold"
                               FontSize="12" />
                        <Label Text="{Binding IdToken}" 
                               FontSize="11"
                               TextColor="DarkGray"
                               LineBreakMode="WordWrap"
                               FontFamily="monospace" />
                    </StackLayout>

                    <Label Text="{Binding IsTokenValid, StringFormat='Token Valid: {0}'}" 
                           FontSize="12"
                           FontAttributes="Bold"
                           TextColor="Green" />
                </VerticalStackLayout>
            </Frame>

            <!-- Buttons Section -->
            <Label Text="Actions:" FontAttributes="Bold" FontSize="14" />

            <StackLayout Spacing="10">
                <Button Text="Read Tokens"
                        Command="{Binding ReadTokensCommand}"
                        IsEnabled="{Binding IsLoading, StringFormat='!{0}'}"
                        Padding="10"
                        Background="Blue"
                        TextColor="White"
                        FontSize="14" />

                <Button Text="Initialize Plugin"
                        Command="{Binding InitializePluginCommand}"
                        IsEnabled="{Binding IsLoading, StringFormat='!{0}'}"
                        Padding="10"
                        Background="Purple"
                        TextColor="White"
                        FontSize="14" />

                <Button Text="Refresh Display"
                        Command="{Binding RefreshTokenDisplayCommand}"
                        IsEnabled="{Binding IsLoading, StringFormat='!{0}'}"
                        Padding="10"
                        Background="Orange"
                        TextColor="White"
                        FontSize="14" />

                <Button Text="Copy Access Token"
                        Command="{Binding CopyAccessTokenCommand}"
                        IsEnabled="{Binding TokenFound}"
                        Padding="10"
                        Background="Green"
                        TextColor="White"
                        FontSize="14" />

                <Button Text="Clear Debug Info"
                        Command="{Binding ClearDebugInfoCommand}"
                        Padding="10"
                        Background="Gray"
                        TextColor="White"
                        FontSize="14" />
            </StackLayout>

            <!-- Info Section -->
            <Frame BorderColor="LightGray" 
                   CornerRadius="10" 
                   Padding="15"
                   HasShadow="True">
                <VerticalStackLayout Spacing="5">
                    <Label Text="ℹ️ How to Use:" 
                           FontAttributes="Bold"
                           FontSize="12" />
                    <Label Text="1. Open SsoMauiApp and login" 
                           FontSize="10"
                           TextColor="Gray" />
                    <Label Text="2. Return to this app" 
                           FontSize="10"
                           TextColor="Gray" />
                    <Label Text="3. Click 'Read Tokens'" 
                           FontSize="10"
                           TextColor="Gray" />
                    <Label Text="4. Tokens should appear below" 
                           FontSize="10"
                           TextColor="Gray" />
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>